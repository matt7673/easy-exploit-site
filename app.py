from flask import Flask, render_template, request, redirect, url_for, send_from_directory
import os

from werkzeug.utils import secure_filename

# Configure upload folder and allowed extensions
UPLOAD_FOLDER = 'uploads/images'
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}

app = Flask(__name__)
app.config['UPLOAD_FOLDER'] = 'uploads/images'

# Dummy data for user credentials (for demonstration purposes)
users = {"user1": "password1", "user2": "password2"}


@app.route('/')
def index():
    return redirect(url_for('login'))

@app.route('/login', methods=['GET', 'POST'])
def login():
    error = None
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        if users.get(username) == password:
            return redirect(url_for('home'))
        else:
            error = 'Invalid Credentials. Please try again.'
    return render_template('login.html', error=error)

@app.route('/home')
def home():
    return render_template('home.html')

@app.route('/gallery')
def gallery():
    # Assuming your images are stored in 'static/images'
    image_folder = os.path.join('static', 'images')
    images = [image for image in os.listdir(image_folder) if image.endswith((".png", ".jpg", ".jpeg"))]
    return render_template('gallery.html', images=images)

@app.route('/upload', methods=['GET', 'POST'])
def upload():
    if request.method == 'POST':
        error = "Something went wrong"
        if 'file' not in request.files:
            error = 'No file part'
            return render_template('upload.html', error=error)
        file = request.files['file']
        if file.filename == '':
            error = 'No selected file'
            return render_template('upload.html', error=error)
        if file:
            error = None
            filename = secure_filename(file.filename)
            file.save(os.path.join(app.config['UPLOAD_FOLDER'], filename))
            return redirect(url_for('gallery'))
    if request.method == 'GET':
        error = None
    return render_template('upload.html', error=error)

@app.route('/uploads/images/<filename>', methods=['GET', 'POST'])
def uploads(filename):
    return send_from_directory(app.config['UPLOAD_FOLDER'], filename)


if __name__ == '__main__':
    app.run(host="0.0.0.0", port=8000, debug=True)
